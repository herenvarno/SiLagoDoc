



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation of SiLago project">
      
      
        <link rel="canonical" href="https://silagokth.github.io/SiLagoDoc/Docs/ToolChain/Vesyla/ProgrammingGuide/">
      
      
        <meta name="author" content="SiLago Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Programming Guide - SiLago Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7cb342">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="light-green" data-md-color-accent="orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#programming-guide" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://silagokth.github.io/SiLagoDoc/" title="SiLago Documentation" aria-label="SiLago Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              SiLago Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Programming Guide
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/silagokth/SiLagoDoc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    silagokth/SiLagoDoc
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Fabric/Overview/" class="md-tabs__link">
          Docs
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../About/About/" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://silagokth.github.io/SiLagoDoc/" title="SiLago Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    SiLago Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/silagokth/SiLagoDoc/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    silagokth/SiLagoDoc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Fabric
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Fabric
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Fabric/Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Tool Chain
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Tool Chain
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2-2" type="checkbox" id="nav-2-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2-2">
      Vesyla
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-2-2">
        Vesyla
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial/" title="Vesyla tutorial" class="md-nav__link">
      Vesyla tutorial
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Programming Guide
      </label>
    
    <a href="./" title="Programming Guide" class="md-nav__link md-nav__link--active">
      Programming Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-guide" class="md-nav__link">
    General Guide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pragma" class="md-nav__link">
    Pragma
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-declaration" class="md-nav__link">
    Variable Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-slicing-and-address-generation" class="md-nav__link">
    Vector Slicing and Address Generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arithmetic-operation" class="md-nav__link">
    Arithmetic Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-loop" class="md-nav__link">
    Static Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loop" class="md-nav__link">
    Dynamic Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#branch" class="md-nav__link">
    Branch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-constraint" class="md-nav__link">
    Address Constraint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    Advanced Features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primitive-function" class="md-nav__link">
    Primitive Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-sharing-region" class="md-nav__link">
    Resource Sharing Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dpu-chain" class="md-nav__link">
    DPU Chain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dpu-internal-scalar-register" class="md-nav__link">
    DPU Internal Scalar Register
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#not-supported" class="md-nav__link">
    Not Supported
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Instruction-Set/" title="Instruction Set" class="md-nav__link">
      Instruction Set
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Cadfg/" title="CADFG - Control Address Data-Flow Graph" class="md-nav__link">
      CADFG - Control Address Data-Flow Graph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Hazzard/" title="Hazard" class="md-nav__link">
      Hazard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ExpressionSimplification/" title="Expression Simplification" class="md-nav__link">
      Expression Simplification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DependencyAnalysis/" title="Dependency Analysis" class="md-nav__link">
      Dependency Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DeadCodeElimination/" title="DeadCodeElimination" class="md-nav__link">
      DeadCodeElimination
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Idg/" title="IDG - Instruction Dependency Graph" class="md-nav__link">
      IDG - Instruction Dependency Graph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Scheduling/" title="Scheduling" class="md-nav__link">
      Scheduling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DiMArch/" title="DiMArch Reading and Writing" class="md-nav__link">
      DiMArch Reading and Writing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../About/About/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../About/License/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basics" class="md-nav__link">
    Basics
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-guide" class="md-nav__link">
    General Guide
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pragma" class="md-nav__link">
    Pragma
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-declaration" class="md-nav__link">
    Variable Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vector-slicing-and-address-generation" class="md-nav__link">
    Vector Slicing and Address Generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arithmetic-operation" class="md-nav__link">
    Arithmetic Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-loop" class="md-nav__link">
    Static Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-loop" class="md-nav__link">
    Dynamic Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#branch" class="md-nav__link">
    Branch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#address-constraint" class="md-nav__link">
    Address Constraint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-features" class="md-nav__link">
    Advanced Features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro" class="md-nav__link">
    Macro
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#primitive-function" class="md-nav__link">
    Primitive Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-sharing-region" class="md-nav__link">
    Resource Sharing Region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dpu-chain" class="md-nav__link">
    DPU Chain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dpu-internal-scalar-register" class="md-nav__link">
    DPU Internal Scalar Register
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#not-supported" class="md-nav__link">
    Not Supported
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/silagokth/SiLagoDoc/edit/master/docs/Docs/ToolChain/Vesyla/ProgrammingGuide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="programming-guide">Programming Guide</h1>
<h2 id="basics">Basics</h2>
<h3 id="general-guide">General Guide</h3>
<p>Vesyla accept modified matlab code as input language. You shouldn't write the matlab code like a programming language. You should instead use it as a tool to model the behaviour of the hardware. Vesyla supports small portion of matlab grammar. There are some generic rules expressing the programming style vesyla accepts.</p>
<ul>
<li>General function call is not allowed unless the function is predefined as primitive function.</li>
<li>Variable except for constant variable and loop iterator should always be decleared via pragma.</li>
<li>Statement should always ends with semicolon (<code class="codehilite"><span class="err">;</span></code>) to avoid unexpected outputs while simulating in matlab.</li>
<li>Constant number is normally treated as integers, not double floating point.</li>
</ul>
<h3 id="pragma">Pragma</h3>
<p>Pragma is the notation that guides Vesyla during synthesis process. Vesyla recongnize pragma starting with symbols <code class="codehilite"><span class="c">%!</span></code>. The main function of pragmas is specify allocation and binding information since Vesyla can't perform automatic allocation and binding. Section <a href="#variable-declaration">Variable Declaration</a>, <a href="#arithmetic-operation">Arithmetic Operation</a>, <a href="#address-constraint">Address Constraint</a> <a href="#dpu_chain">DPU Chain</a> and <a href="#dpu-internal-scalar-register">DPU Internal Scalar Register</a> describe how to use pragmas to allocate and bind resources. Some other usage of pragma also exist, check section <a href="#resource-sharing-region">Resource Sharing Region</a> for more detail.</p>
<h3 id="variable-declaration">Variable Declaration</h3>
<p>Variables supported by Vesyla are vectored Register file variables and SRAM variables. Register file variables will bind to register file and SRAM variables will bind to DiMArch. Since matlab dosen't require variable declaration, we need to give initial value to declare them. You can use the standard initialization assignment for matlab <strong>1-D</strong> arry to declare a variable. Function such as <code class="codehilite"><span class="err">zeros()</span></code> and  <code class="codehilite"><span class="err">ones()</span></code> are also supported.</p>
<p>To declear SRAM variable, you need to use <code class="codehilite"><span class="c">%! MEM[row, col]</span></code> pragma. <code class="codehilite"><span class="err">row</span></code> and <code class="codehilite"><span class="err">col</span></code> are the coordinate of the SRAM block you want to bind for this variable. SRAM usually organized as a 2-D bit matrix without bit-level and word-level access. Data communication with SRAM happens in bulk mode where each data exchange need to be a complete SRAM row. Suppose SRAM with is <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span> and Register width (1 word) is <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> bit. Each SRAM row will have <span><span class="MathJax_Preview">N/M</span><script type="math/tex">N/M</script></span> words. Typical value for <span><span class="MathJax_Preview">M</span><script type="math/tex">M</script></span> and <span><span class="MathJax_Preview">N</span><script type="math/tex">N</script></span> are <span><span class="MathJax_Preview">M=256</span><script type="math/tex">M=256</script></span> and <span><span class="MathJax_Preview">N=16</span><script type="math/tex">N=16</script></span>. Since SRAM only support whole line reading and writing, the SRAM variable you defined should always have multiple of <span><span class="MathJax_Preview">M/N</span><script type="math/tex">M/N</script></span> elements.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>The example shows how to define a SRAM variable <code class="codehilite"><span class="err">y</span></code> on SRAM block <code class="codehilite"><span class="err">[0,0]</span></code>. <code class="codehilite"><span class="err">y</span></code> is initialized by a 1-D vector <code class="codehilite"><span class="err">[1,2,3,4,5,...,16]</span></code>.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! MEM[0,0]</span>
</code></pre></div>
</td></tr></table></p>
</div>
<p>To declear register file variable, you need to use <code class="codehilite"><span class="c">%! RFIL[row, col]</span></code> pragma. <code class="codehilite"><span class="err">row</span></code> and <code class="codehilite"><span class="err">col</span></code> are the coordinate of the DRRA cell you want to bind for this variable. Unlike SRAM, register file is organized in the way that each row will always represent a word. So there is no restriction on the size of register file variable as long as it doesn't exceed the register depth limit.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>The example shows how to define a register file variable <code class="codehilite"><span class="err">x</span></code> on DRRA cell <code class="codehilite"><span class="err">[0,0]</span></code>.<code class="codehilite"><span class="err">x</span></code> has 5 elements and is initialized by a <code class="codehilite"><span class="err">zeros()</span></code> function which will set all elements in <code class="codehilite"><span class="err">x</span></code> to <code class="codehilite"><span class="err">0</span></code>.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c">%! REFI[0,0]</span>
</code></pre></div>
</td></tr></table></p>
</div>
<p>For debugging purpose, vesyla allows initialization of register file variable. However, register should not be initialized with any value other than zeros because the real DRRA cell doesn't have interface to support the register initalization. Register file variables hence should always get data from SRAM variables.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>The following variable declaration style is incorrect:</p>
<ol>
<li>No storage pragma specified
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></li>
<li>Initialized to scalar
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c">%! RFILE[1,1]</span>
</code></pre></div>
</td></tr></table></li>
<li>Initialized to 2-D array
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="c">%! RFILE[1,1]</span>
</code></pre></div>
</td></tr></table></li>
<li>SRAM varible is not the size of SRAM row
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">];</span> <span class="c">%! MEM[0,1]</span>
</code></pre></div>
</td></tr></table></li>
<li>Initialization function <code class="codehilite"><span class="err">randi()</span></code> is not supported
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="n">randi</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span> <span class="c">%! MEM[0,1]</span>
</code></pre></div>
</td></tr></table></li>
</ol>
</div>
<h3 id="vector-slicing-and-address-generation">Vector Slicing and Address Generation</h3>
<p>Each DPU can only process one scalar data each time, so the vectored register variable should be slice first before sending to DPU. The slicing operation is mapped on AGU by REFI instruction. While writing matlab code, you don't have to worry about the slicing since matlab directly support vector slicing.</p>
<p>Here is an example of slicing a vector:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">);</span> <span class="c">%! DPU[0,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<p>If you don't use any slicing and directly feed a vectored register variable to arithmetic operaion, Vesyla will use the full range of that variable.</p>
<p>When slicing a SRAM varialbe, the minimal slice should always be multiple of 16.</p>
<p>Except for the matlab default slicing method, you can also use two primitive AGU function to linear slice a vectored varialbe both in 1-D or 2-D. Example is given below. All address sequence in the following example are "1,2,3,4,5".</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="n">silago_agu_linear_1d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="o">+</span> <span class="n">y</span><span class="p">(</span><span class="n">silago_agu_linear_2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span> <span class="c">%! DPU[0,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="arithmetic-operation">Arithmetic Operation</h3>
<p>Certain type of arithmetic operations are supported by Vesyla. They are addition, subtraction, dot multiplication, sum, abs, etc. Special arithmetic operation need to be mapped to special DPU mode by primitive function call, see section <a href="#primitive-function">Primitive Function</a>.</p>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>Symbol <code class="codehilite"><span class="err">~</span></code> is not supported yet!</p>
</div>
<p>For arithmetic assignment, you can have a multiple variables as output depending on the DPU mode. The ignored output can be muted by symbol <code class="codehilite"><span class="err">~</span></code>.</p>
<p>Arithmetic operation need a computation resource to perform required operation, that is the DPU. So, every arithmetic operation need to bind to a DPU resource via pragma.</p>
<p>Example of an arithmetic assignment is demonstrated as following:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">);</span> <span class="c">%! DPU[0,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="static-loop">Static Loop</h3>
<p>Vesyla accept all static loops. A static loop should have constant start point, static increment as well as static iteration. If an expression that can be simplified to a constant number, it also considered as constant, hence can be used in static loop. Example below shows how to use a static loop.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">n</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span><span class="n"></span>
<span class="hll"><span class="n">for </span><span class="s">i = 1:1:n+1</span><span class="p"></span>
</span>    <span class="c">...</span>
<span class="hll"><span class="k">end</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="dynamic-loop">Dynamic Loop</h3>
<p>Vesyla support limited dynamic loops. Dynamic loop can have dynamic start point, and dynamic iteration. However, those number should be in address domain, a.k.a computed by RACCU and is fully determinastic after unrolling all the loops.</p>
<p>Example of such dynamic loop is shown below:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span>
<span class="hll"><span class="n">    for </span><span class="s">j = i:1:i+3</span><span class="p"></span>
</span>        <span class="c">...</span>
<span class="n">    end</span>
<span class="s">end</span><span class="p"></span>
</code></pre></div>
</td></tr></table>

</div>
<h3 id="branch">Branch</h3>
<p>Vesyla support normal matlab branch except for both operands of condition are constants. The usage of branch is the same as the original matlab code. For example:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">w</span> <span class="p">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="k">if</span> <span class="n">w</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">w</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span>    <span class="n">y</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span><span class="n"></span>
<span class="hll"><span class="n">else</span>
</span><span class="n">    </span><span class="s">y = x+y</span><span class="p">;</span> <span class="c">%! DPU[0,0]</span>
<span class="hll"><span class="k">end</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="address-constraint">Address Constraint</h3>
<p>Address constraints are parameters used by address generation in AGU. Address constraints can be constant or RACCU variable calculated at run-time in RACCU. Dynamic address constraint variables are usually used in loops. Example below shows how to use a RACCU variable to serve as address constraint.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">a</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c">%! RACCU_VAR</span>
</span><span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span>
<span class="hll">    <span class="n">y</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">y</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">a</span><span class="o">+</span><span class="mi">5</span><span class="p">);</span> <span class="c">%! DPU[0,0]</span>
</span>    <span class="n">a</span> <span class="p">=</span> <span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="n"></span>
<span class="n">end</span>
</code></pre></div>
</td></tr></table>

</div>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="macro">Macro</h3>
<p>Vesyla support symbolic expression to enable fast design space exploration. One of the technique is to use macros. Before the lexecal analysis, vesyla will expand all macro to normal program code. Macro gives programmer the tool to generate multiple program with small variations.</p>
<p>Programmer need to provide a template and a series of data. Data is organized in json format and will be loaded in to evaluate those macros defined in template. Template use a grammar like the templating package <a href="https://github.com/pantor/inja">inja</a>. Infact, vesyla directly use inja library to evaluate macros.</p>
<p>Example below demonstrate how to define a loop in template:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>An template file defined as following:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="c">% for x in range(par_col) %}</span>
<span class="n">x0_mem_</span><span class="p">{{</span><span class="n">x</span><span class="p">}}</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, {{x}}]</span>
<span class="n">y0_mem_</span><span class="p">{{</span><span class="n">x</span><span class="p">}}</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, {{x}}]</span>
<span class="p">{</span><span class="c">% endfor %}</span>
</code></pre></div>
</td></tr></table>

<p>With a json-formated data file:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;par_col&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>This template will generate a real matlab code as following by expanding the FOR-LOOP macro:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x0_mem_0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, 0]</span>
<span class="n">y0_mem_0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, 0]</span>
<span class="n">x0_mem_1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, 1]</span>
<span class="n">y0_mem_1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">n</span><span class="o">/</span><span class="n">col</span><span class="p">];</span> <span class="c">%! MEM[0, 1]</span>
</code></pre></div>
</td></tr></table>

</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>More complex usage please visit <a href="https://github.com/pantor/inja">inja</a> website.</p>
</div>
<h3 id="primitive-function">Primitive Function</h3>
<p>Primitive DPU functions are functions that corresponds to a complete DPU mode. Different DPUs targeting on different application domain may have some special modes specifically made for such application domain. For example, sigmoid function for neural network application. Those primitive function is not directly supported by matlab, but they are supported by vesyla.</p>
<p>To use a specific DPU mode as primitive function, first you need to make sure the DRRA cell you are using has such mode. Then you need to change the configuration of vesyla to recongnize such mode. The configuration file is <em>$Vesyla_root/config/primitive_func_def.xml</em>. Finally, you can use the function inside your program.</p>
<p>All primitive DPU functions have name should start with <em>silago_dpu_</em> to be accepted by Vesyla.</p>
<p>Example of using primitive DPU function:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">x</span> <span class="p">=</span> <span class="n">silago_dpu_sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="c">%! DPU[0,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<p>AUGs also have special primitive functions to express the complex addressing mode. But AGU primitive functions are not custom. There are two AGU primitive function: <strong>silago_agu_linear_1d()</strong> and <strong>silago_agu_linear_2d()</strong>. More AGU primitive functions will be added if some application domain requires.</p>
<p>Example of using primitive DPU function:</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">a</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">x</span> <span class="p">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="p">(</span><span class="n">silago_agu_linear_1d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span> <span class="c">%! DPU[0,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="resource-sharing-region">Resource Sharing Region</h3>
<p>When multiple operations need some common operands, due to the limit of the number of reading ports, those operations can't happen at the same time in normal condition. Resource sharing region tries to solve the problem. By enabling the broadcasting mechanism, all operation will recieve the same common operand at the same time generated by single reading port of the register file. The datapath of transmitting the common operand is now shared among those operations.</p>
<p>Resource sharing region requires a fixed datapath layout. Dynamic change of datapath structure is forbidden inside resource sharing region. So, you should only use it when needed.</p>
<p>Following example shows how to active resource sharing region.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x0</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">x1</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[1,0]</span>
<span class="n">a2</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[2,0]</span>
<span class="n">x3</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[3,0]</span>
<span class="n">x4</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[4,0]</span>

<span class="hll"><span class="c">%! RESOURCE_SHARING_BEGIN</span>
</span><span class="n">x0</span> <span class="p">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">a2</span><span class="p">;</span> <span class="c">%! DPU[0,0]</span>
<span class="n">x1</span> <span class="p">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">a2</span><span class="p">;</span> <span class="c">%! DPU[1,0]</span>
<span class="n">x3</span> <span class="p">=</span> <span class="n">x3</span> <span class="o">+</span> <span class="n">a2</span><span class="p">;</span> <span class="c">%! DPU[3,0]</span>
<span class="n">x4</span> <span class="p">=</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">a2</span><span class="p">;</span> <span class="c">%! DPU[4,0]</span>
<span class="hll"><span class="c">%! RESOURCE_SHARING_END</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="dpu-chain">DPU Chain</h3>
<p>Datapath can be configured as a chain of DPU operation. The output of the previous DPU will immediately enter the next DPU without any register file involved in between. Consider we want to compute a vector addition and a sigmoid function: <span><span class="MathJax_Preview">z = \sigma (x+y)</span><script type="math/tex">z = \sigma (x+y)</script></span>. We can employ two DPUs to perform the complete operation in pipelined fashion. By writing the matlab like the following, you can enable the feature.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">z</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">t</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c">%! CDPU[0,0]</span>
</span>
<span class="hll"><span class="n">t</span> <span class="p">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
</span><span class="hll"><span class="n">z</span> <span class="p">=</span> <span class="n">silago_dpu_sigmoid</span><span class="p">(</span><span class="n">t</span><span class="p">);</span> <span class="c">%! DPU[1,0]</span>
</span></code></pre></div>
</td></tr></table>

</div>
<h3 id="dpu-internal-scalar-register">DPU Internal Scalar Register</h3>
<p>Inside each DPU, there are <strong>two</strong> internal scalar registers which can be explicitly used via high-level matlab program. One can use them by declearing them with the pragma <code class="codehilite"><span class="c">%! CDPU[row, col]</span></code>.</p>
<p>The available functions to load and store values to/from internal scalar registers are:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">r0</span> <span class="p">=</span> <span class="n">silago_dpu_load_reg_0</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="n">r1</span> <span class="p">=</span> <span class="n">silago_dpu_load_reg_1</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="p">[</span><span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">]</span> <span class="p">=</span> <span class="n">silago_dpu_load_reg_both</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">silago_dpu_load_store_0</span><span class="p">(</span><span class="n">r0</span><span class="p">);</span>
<span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">silago_dpu_load_store_1</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span>
<span class="p">[</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="p">=</span> <span class="n">silago_dpu_load_store_both</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Programmer should keep in mind that lifetime and physical location of those variable. Vesyla has very weak semantic checking on those internal scalar register variables.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>For example, if one want to calculate a function: <span><span class="MathJax_Preview">y = ax.y</span><script type="math/tex">y = ax.y</script></span>. Instead of put the coefficient <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span> inside a normal register and waste other register entries of the same register block, you can put the coefficient to the internal register, and configure DPU to a scaled multiplication mode to get the correct result.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="n">a_mem</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! SRAM[0,0]</span>
<span class="n">x_mem</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! SRAM[0,0]</span>
<span class="n">y_mem</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! SRAM[0,0]</span>
<span class="n">x</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="n">y</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">16</span><span class="p">];</span> <span class="c">%! REFI[0,0]</span>
<span class="hll"><span class="n">r</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c">%! CDPU[0,0]</span>
</span>
<span class="n">x</span> <span class="p">=</span> <span class="n">a_mem</span><span class="p">;</span>
<span class="hll"><span class="n">r</span> <span class="p">=</span> <span class="n">silago_dpu_load_reg_1</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</span><span class="n">x</span> <span class="p">=</span> <span class="n">x_mem</span><span class="p">;</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">y_mem</span><span class="p">;</span>
<span class="hll"><span class="n">y</span> <span class="p">=</span> <span class="n">silago_dpu_scaled_mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span> <span class="c">%! DPU[0,0]</span>
</span><span class="n">y_mem</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

</div>
<h2 id="not-supported">Not Supported</h2>
<p>Some matlab code is not accepted by Vesyla because it can't execute on DRRA fabric. They are:</p>
<ul>
<li>While-loop.</li>
<li>For-loop inside branch.</li>
<li>Arithmetic statement that can't be mapped to single DPU mode.</li>
<li>Normal function call except for primitive function call.</li>
<li>Indirect addressing.</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Tutorial/" title="Vesyla tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Vesyla tutorial
              </span>
            </div>
          </a>
        
        
          <a href="../Instruction-Set/" title="Instruction Set" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Instruction Set
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>